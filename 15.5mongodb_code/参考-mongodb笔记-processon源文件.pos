{"diagram":{"image":{"x":0,"width":200,"y":0,"pngdata":"iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR4nO3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GXHmAAFMgHIEAAAAAElFTkSuQmCC","height":200},"elements":{"leftChildren":[],"watermark":"","children":[{"parent":"root","lineStyle":{"randomLineColor":"#F88A35"},"children":[{"parent":"6b4296c5497b","children":[{"parent":"ed7a217dc88d","children":[],"id":"fb3bd4a7d916","title":"说明：该文档仅供知识点参考，有些符号processon支持不太友好，以课程上的pdf文档为准。"},{"parent":"ed7a217dc88d","children":[{"parent":"947a774d5fe6","children":[],"id":"c1fd0a20809c","title":"https://www.mongodb.com/"}],"id":"947a774d5fe6","title":"官方地址","summaries":[]},{"parent":"ed7a217dc88d","children":[{"parent":"c94bba1953b0","children":[],"id":"9d280eabb12d","title":"wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu1604-4.4.6.tgz"}],"id":"c94bba1953b0","title":"获取安装包","summaries":[]},{"parent":"ed7a217dc88d","children":[{"parent":"138be785405d","children":[],"id":"e82a617350fc","title":"tar -xvzf mongodb-linux-x86_64-ubuntu1604-4.4.6.tgz"}],"id":"138be785405d","title":"解压","summaries":[]},{"parent":"ed7a217dc88d","children":[{"parent":"99567ff4b052","children":[],"id":"e7f0f2543290","title":"vim /etc/profile 添加&nbsp; &nbsp; &nbsp; &nbsp;export PATH=$PATH:/usr/local/softs/mongodb/mongodb-linux-x86_64-ubuntu1604-4.4.6/bin"},{"parent":"99567ff4b052","children":[],"id":"ad6be0c63260","title":"source /etc/profile"}],"id":"99567ff4b052","title":"添加到系统路径","summaries":[]},{"parent":"ed7a217dc88d","children":[{"parent":"67edc63adaf7","children":[],"id":"68a0b4068466","title":"mkdir -p /data/db/mongodb"}],"id":"67edc63adaf7","title":"创建数据目录","summaries":[]},{"parent":"ed7a217dc88d","children":[{"parent":"0f8c96e0310b","children":[],"id":"106758b693b6","title":"mongod --logpath /data/db/mongodb/logpath/output.log  --fork"}],"id":"0f8c96e0310b","title":"后台启动","summaries":[]},{"parent":"ed7a217dc88d","children":[{"parent":"aad9f5b5c5c7","children":[],"id":"04bb10345d82","title":"mongod --auth"}],"id":"aad9f5b5c5c7","title":"授权模式启动","summaries":[]}],"id":"ed7a217dc88d","title":"① 安装","summaries":[]},{"parent":"6b4296c5497b","children":[{"parent":"a9d77e417af8","children":[{"parent":"8c43a6c402a2","children":[{"parent":"8a9d8cfacaa5","children":[],"id":"6ab626303a57","title":"mongo --host 127.0.0.1 --port  27017"}],"id":"8a9d8cfacaa5","title":"连接","summaries":[]},{"note":"设置密码需要切换到admin库\n","parent":"8c43a6c402a2","children":[{"parent":"3107746121a3","children":[],"id":"fe1dc7ccaea6","title":"use admin"},{"parent":"3107746121a3","children":[],"id":"a1bc12c014ef","title":"db.createUser({user:&amp;quot;lqf&amp;quot;,pwd:&amp;quot;123456&amp;quot;,roles:[&amp;quot;root&amp;quot;]});"},{"note":"查看所有用户信息\n\n","parent":"3107746121a3","children":[],"id":"d3f842ba640f","title":"show users"}],"id":"3107746121a3","title":"设置密码","summaries":[]},{"parent":"8c43a6c402a2","children":[{"parent":"7fcb2d6dc16e","children":[],"id":"b11da6b89d5f","title":"db.shutdownServer()"}],"id":"7fcb2d6dc16e","title":"停服务","summaries":[]},{"parent":"8c43a6c402a2","children":[{"parent":"ad08d717f6f3","children":[],"id":"7d82e9726574","title":"exit"}],"id":"ad08d717f6f3","title":"退出","summaries":[]},{"parent":"8c43a6c402a2","children":[{"parent":"e5ece0baeea1","children":[],"id":"d2d4558de225","title":"mongo -u lqf"}],"id":"e5ece0baeea1","title":"授权模式连接","summaries":[]}],"id":"8c43a6c402a2","title":"客户端使用","summaries":[]},{"note":"MongoDB基于安全性考虑，默认安装后只会绑定本地回环\u00A0IP\u00A0127.0.0.1,\u00A0可以通过启动服务时，指定\n绑定的IP\u00A0\u00A0如\u00A0只允许通过\u00A0IP:\u00A0\u00A0192.168.109.200\u00A0访问\nmongod\u00A0‐‐bind_ip\u00A0192.168.109.200\n\n这时登录需要通过\nmongo\u00A0‐host\u00A0192.168.109.200\u00A0‐u\u00A0gj\n","parent":"a9d77e417af8","children":[],"id":"e8862ed46821","title":"安全说明"},{"parent":"a9d77e417af8","children":[{"parent":"949947dcaf18","children":[{"parent":"08caa132f7c2","children":[],"id":"6432a831e412","title":"help"}],"id":"08caa132f7c2","title":"查看命令","summaries":[]},{"parent":"949947dcaf18","children":[{"parent":"7407782afb04","children":[],"id":"d86dbea14c3b","title":"db"}],"collapsed":false,"id":"7407782afb04","title":"显示当前所在的库","summaries":[]},{"parent":"949947dcaf18","children":[{"parent":"75b839e8f506","children":[],"id":"886f133b6a49","title":"use example"}],"id":"75b839e8f506","title":"切换数据库","summaries":[]},{"note":"插入文档时，如果没有显示指定主键，MongoDB将默认创建一个主键，字段固定为_id,ObjectId()\n可以快速生成的12字节id\u00A0作为主键，ObjectId\u00A0前四个字节代表了主键生成的时间，精确到秒。主键\nID在客户端驱动生成，一定程度上代表了顺序性，但不保证顺序性，\u00A0可以通过ObjectId(\"id\n值\").getTimestamp()\u00A0获取创建时间。\n","parent":"949947dcaf18","children":[{"parent":"7828be5727b2","children":[{"parent":"0aa9456390c1","children":[],"id":"dafff1227d00","title":"db.集合.insertOne(&amp;lt;json对象&amp;gt;)"},{"parent":"0aa9456390c1","children":[],"id":"6f7a354db31c","title":"db.集合.insert()"}],"id":"0aa9456390c1","title":"添加单个文档","summaries":[]},{"parent":"7828be5727b2","children":[{"parent":"b0c26a78d3fe","children":[],"id":"8488023579d3","title":"db.userinfo.insertMany([{name:&amp;quot;lqf&amp;quot;,age:19},{name:&amp;quot;zhangsan&amp;quot;,age:90}])"}],"id":"b0c26a78d3fe","title":"批量添加文档","summaries":[]},{"parent":"7828be5727b2","children":[{"note":"writeConcern\u00A0定义了本次文档创建操作的安全写级别简单来说，\u00A0安全写级别用来判断一次数据库写\n入操作是否成功，安全写级别越高，丢失数据的风险就越低，然而写入操作的延迟也可能更高。\nwriteConcern\u00A0决定一个写操作落到多少个节点上才算成功。\u00A0writeConcern的取值包括\n0：\u00A0发起写操作，不关心是否成功\n1-\u00A0集群中最大数据节点数：\u00A0写操作需要被复制到指定节点数才算成功\nmajority:\u00A0写操作需要被复制到大多数节点上才算成功\n发起写操作的程序将阻塞到写操作到达指定的节点数为止\n","parent":"a3ffef7d1be7","children":[],"id":"e30de2ae4478","title":"db.集合.insert(doc，{writeConcern:安全级别})"}],"id":"a3ffef7d1be7","title":"安全写","summaries":[]},{"parent":"7828be5727b2","children":[{"note":"ordered:\u00A0\u00A0觉得是否按顺序进行写入\n顺序写入时，一旦遇到错误，便会退出，剩余的文档无论正确与否，都不会写入\n乱序写入，则只要文档可以正确写入就会正确写入，不管前面的文档是否是错误的文档\nMongoDB以集合（collection）的形式组织数据，collection\u00A0相当于关系型数据库中的表，如果\ncollection不存在，当你对不存在的collection进行操作时，将会自动创建一个collection\n","parent":"04f9af3783d9","children":[],"id":"98d77c65d053","title":"db.集合.insert(doc，{writeConcern:安全级别,ordered:true/false})"}],"id":"04f9af3783d9","title":"是否顺序写","summaries":[]},{"note":"db.demeDoc.insert(\n {\n  _id: { product_name: 1, product_type: 2},\n supplierId:&quot; 001&quot;,\n create_Time: new Date()\n }\n )\n\n注意复合主键，字段顺序换了，会当做不同的对象被创建，即使内容完全一致\n","parent":"7828be5727b2","children":[],"id":"e5ebf09e2bab","title":"复合主键"}],"id":"7828be5727b2","title":"添加文档","summaries":[]},{"parent":"949947dcaf18","children":[{"parent":"8e1349d62b44","children":[{"parent":"e55dcb16e97b","children":[{"parent":"1333cbdf7ffc","children":[],"id":"0e4500d930d1","title":"db.userinfo.find()"}],"id":"1333cbdf7ffc","title":"查询所有文档","summaries":[]},{"parent":"e55dcb16e97b","children":[{"parent":"6718278ed0d8","children":[],"id":"f0aef6e91a3b","title":"db.userinfo.find().pretty()"}],"id":"6718278ed0d8","title":"返回格式化文档","summaries":[]}],"id":"e55dcb16e97b","title":"查看文档","summaries":[]},{"parent":"8e1349d62b44","children":[{"parent":"7e381cfae6c3","children":[{"parent":"7b37f7fb006c","children":[{"parent":"4366f0a087b4","children":[],"id":"97bdd43b38c8","title":"skip和limit不起作用"}],"id":"4366f0a087b4","title":"db.movies.find().skip(1).limit(1).count()","summaries":[]},{"parent":"7b37f7fb006c","children":[{"parent":"e07ea9f57557","children":[],"id":"53e65b3063e9","title":"skip和limit起作用"}],"id":"e07ea9f57557","title":"db.movies.find().skip(1).limit(1).count(true)","summaries":[]}],"id":"7b37f7fb006c","title":"文档游标","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"dc0b189dbdde","children":[],"id":"d6f1922efb7e","title":"db.userinfo.find({age:18})"}],"id":"dc0b189dbdde","title":"精准等值查询","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"138500a5b371","children":[],"id":"7a44928b4af4","title":"db.userinfo.find({name:&amp;quot;lqf&amp;quot;,age:19})"}],"id":"138500a5b371","title":"多条件查询","summaries":[]},{"parent":"7e381cfae6c3","children":[{"note":"db.inventory.insertMany([\n\u00A0{\u00A0item:\u00A0\"journal\",\u00A0qty:\u00A025,\u00A0status:\u00A0\"A\",\u00A0size:\u00A0{\u00A0h:\u00A014,\u00A0w:\u00A021,\u00A0uom:\u00A0\"cm\"\u00A0},\u00A0tags:\n[\u00A0\"blank\",\u00A0\"red\"\u00A0]\u00A0},\n\u00A0{\u00A0item:\u00A0\"notebook\",\u00A0qty:\u00A050,\u00A0status:\u00A0\"A\",\u00A0size:\u00A0{\u00A0h:\u00A08.5,\u00A0w:\u00A011,\u00A0uom:\u00A0\"in\"\u00A0},\u00A0tag\ns:\u00A0[\u00A0\"red\",\u00A0\"blank\"\u00A0]\u00A0},\n\u00A0{\u00A0item:\u00A0\"paper\",\u00A0qty:\u00A010,\u00A0status:\u00A0\"D\",\u00A0size:\u00A0{\u00A0h:\u00A08.5,\u00A0w:\u00A011,\u00A0uom:\u00A0\"in\"\u00A0},\u00A0tags:\n[\u00A0\"red\",\u00A0\"blank\",\u00A0\"plain\"\u00A0]\u00A0},\n\u00A0{\u00A0item:\u00A0\"planner\",\u00A0qty:\u00A00,\u00A0status:\u00A0\"D\",\u00A0size:\u00A0{\u00A0h:\u00A022.85,\u00A0w:\u00A030,\u00A0uom:\u00A0\"cm\"\u00A0},\u00A0tag\ns:\u00A0[\u00A0\"blank\",\u00A0\"red\"\u00A0]\u00A0},\n\u00A0{\u00A0item:\u00A0\"postcard\",\u00A0qty:\u00A045,\u00A0status:\u00A0\"A\",\u00A0size:\u00A0{\u00A0h:\u00A010,\u00A0w:\u00A015.25,\u00A0uom:\u00A0\"cm\"\u00A0},\u00A0t\nags:\u00A0[\u00A0\"blue\"\u00A0]\u00A0}\n]);\n","parent":"089595111aa3","children":[],"id":"2245936371e3","title":"db.inventory.find(\u00A0{\u00A0&amp;quot;size.uom&amp;quot;:\u00A0&amp;quot;in&amp;quot;\u00A0}\u00A0)"}],"id":"089595111aa3","title":"嵌套对象精准查询","summaries":[]},{"parent":"7e381cfae6c3","children":[{"note":"默认会返回_id\u00A0字段，\u00A0同样可以通过指定\u00A0\u00A0_id:0\u00A0,不返回_id\u00A0字段\n","parent":"0a3febe4a65f","children":[],"id":"f1442f2f9461","title":"db.movies.find({},{year:1})"}],"id":"0a3febe4a65f","title":"返回指定字段","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"683f66d93d17","children":[],"id":"cabcd21bf07c","title":"db.movies.find({$and:[{year:1942},{&amp;quot;rated&amp;quot;:&amp;quot;PG&amp;quot;}]}).pretty();"},{"parent":"683f66d93d17","children":[{"note":"db.movies.find({year:{$eq:1942}},{\"rated\":{$eq:\"PG\"}}).pretty();\n","parent":"c3ccf646c38a","children":[],"id":"01f89cae69f4","title":"作用在不用字段，可以省略$and"}],"id":"c3ccf646c38a","title":"db.movies.find({$and:[{year:{$eq:1942}},{&amp;quot;rated&amp;quot;:{$eq:&amp;quot;PG&amp;quot;}}]}).pretty();","summaries":[]}],"id":"683f66d93d17","title":"条件查询and","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"5ee57c9e2227","children":[],"id":"60ea9a878339","title":"db.movies.find({$or:[{year:1942},{&amp;quot;rated&amp;quot;:&amp;quot;PG&amp;quot;}]}).pretty()"},{"parent":"5ee57c9e2227","children":[],"id":"d610580db831","title":"db.movies.find({$or:[{year:{$gt:1942}},{&amp;quot;rated&amp;quot;:{$eq:&amp;quot;PG&amp;quot;}}]}).pretty()"}],"id":"5ee57c9e2227","title":"条件查询or","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"9d3829ee237c","children":[],"id":"c4fc2e24fa1a","title":"db.members.find({points:\u00A0{\u00A0$not:\u00A0{\u00A0$lt:\u00A0100}}}\u00A0);"}],"id":"9d3829ee237c","title":"条件查询not","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"d407cede797b","children":[{"parent":"98c3af029aa4","children":[],"id":"2bae21914d41","title":"{a:{$ne:1}}"}],"id":"98c3af029aa4","title":"a&amp;lt;&amp;gt;1 或者a!=1","summaries":[]},{"parent":"d407cede797b","children":[{"parent":"d057e61cb6fd","children":[],"id":"e3edff4b26ff","title":"{a:{$gt:1}}"}],"id":"d057e61cb6fd","title":"a&amp;gt;1","summaries":[]},{"parent":"d407cede797b","children":[{"parent":"c6460c41c495","children":[],"id":"feb8e13dd0bc","title":"{a:{$gt:1}}"}],"id":"c6460c41c495","title":"a&amp;lt;=1","summaries":[]},{"parent":"d407cede797b","children":[{"parent":"fdaadd7d2707","children":[],"id":"9b872cfa51ce","title":"{a:{$lt:1}}"}],"id":"fdaadd7d2707","title":"a&amp;lt;1","summaries":[]},{"parent":"d407cede797b","children":[{"parent":"4ea5f02a292b","children":[],"id":"2e935780a350","title":"{a:{$lte:1}}"}],"id":"4ea5f02a292b","title":"a&amp;lt;=1","summaries":[]},{"parent":"d407cede797b","children":[{"parent":"a4a0058f196a","children":[],"id":"d39edfd5c9f8","title":"{a:{$in:[x,y,z]}}"}],"id":"a4a0058f196a","title":"in","summaries":[]},{"parent":"d407cede797b","children":[{"parent":"0145daffc56c","children":[],"id":"561fbc9660b0","title":"{a:{$nin:[x,y,z]}}"}],"id":"0145daffc56c","title":"not in","summaries":[]},{"parent":"d407cede797b","children":[{"parent":"ecbbdc236916","children":[],"id":"bbcc634a9a09","title":"{a:{$exists:false}}"}],"id":"ecbbdc236916","title":"a is null","summaries":[]}],"id":"d407cede797b","title":"mongo查询条件和SQL对照表","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"f0b8ff6f1901","children":[{"parent":"8e76e7e61215","children":[],"id":"a805aee2eb29","title":"db.movies.find().sort({year:1}).pretty()"}],"id":"8e76e7e61215","title":"正序","summaries":[]},{"parent":"f0b8ff6f1901","children":[{"parent":"01cb543b4aa1","children":[],"id":"dbe66fc050b6","title":"db.movies.find().sort({year:-1}).pretty()"}],"id":"01cb543b4aa1","title":"倒序","summaries":[]}],"id":"f0b8ff6f1901","title":"排序----sort","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"fea85ad4a851","children":[],"id":"3624f5da14b6","title":"db.members.find({},{_id:0\u00A0,nickName:1,\u00A0points:1})"},{"parent":"fea85ad4a851","children":[],"id":"011e057d364f","title":"db.members.find({},{_id:0\u00A0,nickName:1,\u00A0points:0})"}],"id":"fea85ad4a851","title":"投影设置","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"8a0e83cf616c","children":[{"parent":"95e1d36a0e83","children":[],"id":"9a86a1af4f0e","title":"db.movies.find({},{_id:0,year:1,rated:1,cast:{$slice:1}}).pretty()"}],"id":"95e1d36a0e83","title":"返回数组第一个元素","summaries":[]},{"parent":"8a0e83cf616c","children":[{"parent":"dab4180772ac","children":[],"id":"36ccfb380383","title":"db.movies.find({},{_id:0,year:1,rated:1,cast:{$slice:-1}}).pretty()"}],"id":"dab4180772ac","title":"返回数组倒数第一个元素","summaries":[]},{"parent":"8a0e83cf616c","children":[{"parent":"b3531b9a7526","children":[],"id":"c902a1eeebf1","title":"db.movies.find({},{_id:0,year:1,rated:1,cast:{$slice:[0,1]}}).pretty()"},{"parent":"b3531b9a7526","children":[],"id":"0c98d1f6620b","title":"db.movies.find({},{_id:0,year:1,rated:1,cast:{$slice:[1,6]}}).pretty()"}],"id":"b3531b9a7526","title":"数组中间截取","summaries":[]}],"id":"8a0e83cf616c","title":"返回数据的部分元素----$slice","summaries":[]},{"parent":"7e381cfae6c3","children":[{"parent":"2cdc2bc89768","children":[],"id":"9616d84c8890","title":"db.movies.find({},{_id:0,year:1,rated:1,cast:{$elemMatch:{$eq:&amp;quot;Miyu Irino&amp;quot;}}}).pretty()"}],"id":"2cdc2bc89768","title":"数组元素匹配----$elemMatch","summaries":[]}],"id":"7e381cfae6c3","title":"条件查询","summaries":[{"summary":true,"parent":"7e381cfae6c3","children":[],"part":"right","range":"9,9","id":"39d92cf74a53","title":"1\u00A0表示由小到大，\u00A0-1\u00A0表示逆向排序\n当同时应用\u00A0\u00A0sort，\u00A0skip，\u00A0limit\u00A0时\u00A0，应用的顺序为\u00A0\u00A0\u00A0sort，\u00A0skip，\u00A0limit"},{"summary":true,"parent":"7e381cfae6c3","children":[],"part":"right","range":"10,10","id":"624855c807c1","title":"{\u00A0field:\u00A0\u00A0\u00A0&amp;lt;\u00A01\u00A0：1\u00A0表示需要返回，\u00A00：\u00A0表示不需要返回\u00A0，\u00A0只能为\u00A00，或者1\u00A0，\u00A0非主键字\n段，不能同时混选0\u00A0或\u00A01&amp;gt;}"},{"summary":true,"parent":"7e381cfae6c3","children":[],"part":"right","range":"11,11","id":"f31cc75d4e18","title":"slice:\u00A0值\n\u00A01：\u00A0数组第一个元素\n-1：最后一个元素\n-2：最后两个元素\nslice[\u00A01,2\u00A0]\u00A0:\u00A0skip,\u00A0limit\u00A0\u00A0对应的关系"},{"summary":true,"parent":"7e381cfae6c3","children":[],"part":"right","range":"0,0","id":"0631f3dcf01f","title":"分布式环境下，count不保证数据的绝对正确"}]}],"id":"8e1349d62b44","title":"查看文档","summaries":[]},{"note":"updateOne/updateMany\u00A0方法要求更新条件部分必须具有以下之一，否则将报错\n$set\u00A0\u00A0\u00A0给符合条件的文档新增一个字段，有该字段则修改其值\n$unset\u00A0\u00A0给符合条件的文档，删除一个字段\n$push：\u00A0增加一个对象到数组底部\n$pop：从数组底部删除一个对象\n$pull：如果匹配指定的值，从数组中删除相应的对象\n$pullAll：如果匹配任意的值，从数据中删除相应的对象\n$addToSet：如果不存在则增加一个值到数组\n","parent":"949947dcaf18","children":[{"note":"<query>\u00A0定义了更新时的筛选条件\n<update>\u00A0文档提供了更新内容\n<options>\u00A0声明了一些更新操作的参数\n更新文档操作只会作用在第一个匹配的文档上\n如果<update>\u00A0不包含任何更新操作符，则会直接使用update\u00A0文档替换集合中符合文档筛选条件的\n文档\n","parent":"35745f687aae","children":[],"id":"1da9b0e892ad","title":"db.collection.update(\u00A0&amp;lt;query&amp;gt;,&amp;lt;update&amp;gt;,&amp;lt;options&amp;gt;)"},{"parent":"35745f687aae","children":[{"parent":"0d5f7ee51089","children":[],"id":"1595017031e5","title":"db.userInfo.updateMany( {tag:&amp;quot;90&amp;quot;},{$set{flag:1}}\n);"},{"parent":"0d5f7ee51089","children":[],"id":"afa31db6fada","title":"db.userInfo.updateOne( {tag:&amp;quot;90&amp;quot;},{$set{flag:1}}\n);"}],"id":"0d5f7ee51089","title":"将tag\u00A0中有90\u00A0的文档，增加一个字段：\u00A0flag:\u00A01","summaries":[]},{"note":"db.collection.update(\u00A0<query>,<update>,<options>)\n<query>\u00A0定义了更新时的筛选条件\n<update>\u00A0文档提供了更新内容\n<options>\u00A0声明了一些更新操作的参数\n如果<update>只包含更新操作符，db.collection.update()\u00A0将会使用update更新集合中符合\n<query>筛选条件的文档中的特定字段。\n db.doc.update(\n \u00A0{name:\"zhangsan\"},\n \u00A0{$set:{\u00A0flag:\u00A01\u00A0}},\n\u00A0{multi:true}\n );\n","parent":"35745f687aae","children":[],"id":"7732c861b1c0","title":"更新特定字段"},{"parent":"35745f687aae","children":[{"parent":"03aa3a3fc9de","children":[],"id":"c5fa438aa166","title":"$set\u00A0更新或新增字段"},{"parent":"03aa3a3fc9de","children":[],"id":"b0982dd3fa1c","title":"$unset删除字段"},{"parent":"03aa3a3fc9de","children":[],"id":"ed1a482468d2","title":"$rename\u00A0重命名字段"},{"parent":"03aa3a3fc9de","children":[],"id":"f4a268c945a0","title":"$inc\u00A0加减字段值"},{"parent":"03aa3a3fc9de","children":[],"id":"cf95ac24e63d","title":"$mul\u00A0相乘字段值"},{"parent":"03aa3a3fc9de","children":[],"id":"d446e9cae431","title":"$min\u00A0\u00A0采用最小值\u00A0"},{"parent":"03aa3a3fc9de","children":[],"id":"aaa4eda1efd3","title":"$max\u00A0\u00A0次用最大值"}],"id":"03aa3a3fc9de","title":"更新操作符","summaries":[]}],"id":"35745f687aae","title":"更新文档","summaries":[]},{"parent":"949947dcaf18","children":[{"parent":"0fb59d0f9b3c","children":[{"note":"默认情况下，会删除所有满足条件的文档，\u00A0可以设定参数\u00A0{\u00A0justOne:true},只会删除满足添加的第一\n条文档\n","parent":"d956e3b8aaf8","children":[],"id":"36d4635612a5","title":"db.collection.remove(&amp;lt;query&amp;gt;,&amp;lt;options&amp;gt;)"}],"id":"d956e3b8aaf8","title":"删除文档","summaries":[]},{"parent":"0fb59d0f9b3c","children":[{"note":"<doc>\u00A0定义了本次删除集合操作的安全写级别\n这个指令不但删除集合内的所有文档，且删除集合的索引\n","parent":"7740383babf3","children":[],"id":"bdb734edf0ac","title":"db.collection.drop(\u00A0{\u00A0writeConcern:&amp;lt;doc&amp;gt;})"}],"id":"7740383babf3","title":"删除集合","summaries":[]}],"id":"0fb59d0f9b3c","title":"删除文档","summaries":[]}],"id":"949947dcaf18","title":"命令","summaries":[]}],"id":"a9d77e417af8","title":"② 基本使用","summaries":[]},{"parent":"6b4296c5497b","children":[{"parent":"71d70a4f984f","children":[{"parent":"6452d976a476","children":[],"id":"31f8d260c302","title":"加两个字段totalPrice，totalCost"},{"parent":"6452d976a476","children":[],"id":"c3634ea66605","title":"对数组awards的字段wins和 nominations  求和"}],"id":"6452d976a476","title":"db.movies.aggregate([{$addFields:{totalPrice:{$sum:&amp;quot;$awards.wins&amp;quot;},totalCost:{$sum:&amp;quot;$awards.nominations&amp;quot;}}}])","summaries":[]},{"parent":"71d70a4f984f","children":[{"parent":"0c0175c99b80","children":[],"id":"fe33efdf2a39","title":"对totalPrice进行排序"},{"parent":"0c0175c99b80","children":[],"id":"744b1d695cd6","title":"-1：倒序   1：正序"}],"id":"0c0175c99b80","title":"db.movies.aggregate([{$addFields:{totalPrice:{$sum:&amp;quot;$awards.wins&amp;quot;},totalCost:{$sum:&amp;quot;$awards.nominations&amp;quot;}}},{$sort:{totalPrice:-1}}])","summaries":[]},{"parent":"71d70a4f984f","children":[{"parent":"e9ce913fed3a","children":[{"parent":"175e79feee0a","children":[],"id":"bf5caa539916","title":"$&amp;lt;field&amp;gt; : 用$指示字段路径"},{"parent":"175e79feee0a","children":[],"id":"900b343f1e67","title":"$&amp;lt;filed&amp;gt;.&amp;lt;sub filed&amp;gt; : 使用$和.来指示内嵌文档的路径"}],"id":"175e79feee0a","title":"获取字段信息","summaries":[]},{"parent":"e9ce913fed3a","children":[{"parent":"4fb954b1ea97","children":[],"id":"719b6f010191","title":"$literal\u00A0:&amp;lt;value&amp;gt;\u00A0：\u00A0指示常量\u00A0&amp;lt;value&amp;gt;"}],"id":"4fb954b1ea97","title":"常量表达式","summaries":[]},{"parent":"e9ce913fed3a","children":[{"parent":"8a092e71c27c","children":[],"id":"156d44770782","title":"$$&amp;lt;variable&amp;gt;\u00A0\u00A0使用\u00A0$$\u00A0指示系统变量"}],"id":"8a092e71c27c","title":"系统变量表达式","summaries":[]}],"id":"e9ce913fed3a","title":"聚合表达式","summaries":[]},{"note":"准备数据\ndb.userInfo.insertMany([{nickName:\"zhangsan\",age:18},{nickName:\"lisi\",age:20}]);\n\ndb.userInfo.insertOne({\"nickName\":\"xixi\",age:35,tags:[\"80\",\"IT\",\"BeiJing\"]});\n","parent":"71d70a4f984f","children":[{"parent":"75a9650b1942","children":[{"parent":"60adbaffea7c","children":[{"parent":"d7e40b8a6ac5","children":[],"id":"6aaa9d44460a","title":"db.userInfo.aggregate({$project:{ name : &amp;quot;$nickName&amp;quot;}});"}],"id":"d7e40b8a6ac5","title":"将集合中的nickName投影成name","summaries":[]},{"parent":"60adbaffea7c","children":[{"parent":"ac5c74456b8e","children":[],"id":"7b77355d575f","title":"db.userInfo.aggregate({$project:{ name : &amp;quot;$nickName&amp;quot;,_id:0,age:1}})"}],"id":"ac5c74456b8e","title":"灵活控制输出文档的格式，可以剔除不需要的字段","summaries":[]}],"id":"60adbaffea7c","title":"$project\u00A0\u00A0对输入文档进行再次投影","summaries":[]},{"note":"筛选管道操作和其他管道操作配合时候时，尽量放到开始阶段，这样可以减少后续管道操作符要操作的文\n档数，提升效率\n\ndb.userInfo.aggregate(\n [\n \u00A0{\u00A0$match:\n \u00A0{\u00A0$and:\n \u00A0[\u00A0{\u00A0age:\u00A0{\u00A0$gte:20}},\n \u00A0{\u00A0nickName:{\u00A0$eq:\"lisi\"}}\n \u00A0]\n \u00A0}\n \u00A0},\n \u00A0{\n \u00A0$project:\u00A0{\u00A0_id:0,\u00A0name:\u00A0\"$nickName\",\u00A0age:1}\n }\n ]\n );\n","parent":"75a9650b1942","children":[{"parent":"4e100009f459","children":[],"id":"3642bedbdd56","title":"db.userInfo.aggregate({$match:{nickName:&amp;quot;lisi&amp;quot;}})"},{"parent":"4e100009f459","children":[{"parent":"3de8263ad465","children":[],"id":"b92fe7aa37ff","title":"先筛选再投影"}],"id":"3de8263ad465","title":"db.userInfo.aggregate([{$match:{nickName:&amp;quot;lisi&amp;quot;}},{$project:{_id:0,name:&amp;quot;$nickName&amp;quot;,age:1}}])","summaries":[]}],"id":"4e100009f459","title":"$match\u00A0对输入文档进行筛选","summaries":[]},{"parent":"75a9650b1942","children":[{"parent":"669f25ea6e01","children":[],"id":"1caed957b283","title":"db.userInfo.aggregate({$limit:1});"}],"id":"669f25ea6e01","title":"$limit\u00A0筛选出管道内前\u00A0N\u00A0篇文档","summaries":[]},{"parent":"75a9650b1942","children":[{"parent":"fdcf8760cf18","children":[],"id":"cc2f7b7d0937","title":"db.userInfo.aggregate({$skip:1});"}],"id":"fdcf8760cf18","title":"$skip\u00A0跳过管道内前N篇文档","summaries":[]},{"parent":"75a9650b1942","children":[{"parent":"b26c28a9bf28","children":[],"id":"d0e99d3a2c09","title":"db.userInfo.aggregate({$unwind : {path:&amp;quot;$tags&amp;quot;}});"},{"parent":"b26c28a9bf28","children":[{"parent":"f3438b828dd2","children":[],"id":"19b59544b04b","title":"\u00A0includeArrayIndex:\u00A0\u00A0加上数组元素的索引值，\u00A0赋值给后面指定的字段"}],"id":"f3438b828dd2","title":"db.userInfo.aggregate({$unwind : {path:&amp;quot;$tags&amp;quot;,includeArrayIndex:&amp;quot;arrIndex&amp;quot;}});","summaries":[]},{"parent":"b26c28a9bf28","children":[{"parent":"edc9dfceb02d","children":[],"id":"6ec81b162cf3","title":"preserveNullAndEmptyArrays:true\n展开时保留空数组，或者不存在数组字段的文档"}],"id":"edc9dfceb02d","title":"db.userInfo.aggregate({$unwind : {path:&amp;quot;$tags&amp;quot;,includeArrayIndex:&amp;quot;arrIndex&amp;quot;,preserveNullAndEmptyArrays:true}});","summaries":[]}],"id":"b26c28a9bf28","title":"$unwind\u00A0展开输入文档中的数组字段","summaries":[]},{"parent":"75a9650b1942","children":[{"parent":"0fa814e8c443","children":[],"id":"8c8ab8cc7f62","title":"db.userInfo.aggregate({$sort:{age:-1}})"},{"parent":"0fa814e8c443","children":[],"id":"dc2a9f7c1145","title":"$sort\u00A0\u00A0对文档进行排序：\u00A01\u00A0正序，\u00A0-1\u00A0倒序"}],"id":"0fa814e8c443","title":"$sort\u00A0对输入文档进行排序","summaries":[]},{"note":"准备数据\ndb.account.insertMany([{_id:1,name:\"zhangsan\",age:19},{_id:2,name:\"lisi\",age:20}]);\ndb.accountDetail.insertMany([{aid:1,address:[\"address1\",\"address2\"]}]);\n\n用法\n$lookup:{\n from:\u00A0需要关联的文档,\n localField:\u00A0本地字段，\n foreignField:\u00A0外部文档关联字段，\n as\u00A0作为新的字段，添加到文档中\n }\n","parent":"75a9650b1942","children":[{"parent":"af0ef2c3887d","children":[],"id":"68200dfc7175","title":"db.accountDetail.aggregate({ $lookup :   {from:&amp;quot;account&amp;quot;,localField:&amp;quot;aid&amp;quot;,foreignField:&amp;quot;_id&amp;quot;,as:&amp;quot;field1&amp;quot;  }  });"}],"id":"af0ef2c3887d","title":"$lookup\u00A0对输入文档进行查询操作","summaries":[]},{"note":"构造数据：\ndb.sales.insertMany([{_id:1,item:\"abc\",price:10,quantity:2,date:ISODate(\"2014-01-01T08:00:00Z\")},{_id:2,item:\"jkl\",price:20,quantity:1,date:ISODate(\"2014-02-03T09:00:00Z\")},{_id:3,item:\"xyz\",price:5,quantity:5,date:ISODate(\"2014-02-03T09:05:00Z\")},{_id:4,item:\"abc\",price:10,quantity:10,date:ISODate(\"2014-02-15T08:00:00Z\")},{_id:5,item:\"xyz\",price:5,quantity:10,date:ISODate(\"2014-02-15T09:12:00Z\")} ,{_id:6,item:\"xyz\",price:5,quantity:10,date:ISODate(\"2014-02-15T09:12:00Z\")}]);\n","parent":"75a9650b1942","children":[{"parent":"7001ec437efe","children":[{"parent":"2f7424b218ac","children":[],"id":"841639c8d652","title":"db.sales.aggregate([{$group:{_id:{day:{$dayOfYear:&amp;quot;$date&amp;quot;},year:{$year:&amp;quot;$date&amp;quot;} },itemsSold:{$addToSet:&amp;quot;$item&amp;quot;}  }  }])"}],"id":"2f7424b218ac","title":"$addToSet\u00A0：将分组中的元素添加到一个数组中，并且自动去重","summaries":[]},{"parent":"7001ec437efe","children":[{"parent":"c2685ff2cddd","children":[],"id":"a9053e03d1df","title":"db.sales.aggregate([{$group: {_id:&amp;quot;$item&amp;quot;,avgAmount:{$avg:{$multiply:[&amp;quot;$price&amp;quot;,&amp;quot;$quantity&amp;quot;]}},avgQuantity:{$avg:&amp;quot;$quantity&amp;quot;} } }]);"}],"id":"c2685ff2cddd","title":"$avg\u00A0\u00A0\u00A0返回分组中的平均值，\u00A0非数值直接忽略","summaries":[]},{"parent":"7001ec437efe","children":[],"id":"4c22c647ce41","title":"$first\u00A0\u00A0\u00A0返回分组中的第一个元素"},{"parent":"7001ec437efe","children":[],"id":"4f6026dcc1be","title":"$last\u00A0\u00A0\u00A0\u00A0返回分组中的最后一个元素"},{"parent":"7001ec437efe","children":[],"id":"caceb1ccd877","title":"$max\u00A0\u00A0返回分组中的最大元素"},{"parent":"7001ec437efe","children":[],"id":"097ff1c09bb5","title":"$min\u00A0\u00A0回分组中的最小元素"},{"note":"db.sales.aggregate(\n \u00A0[\n \u00A0{\n\u00A0$group:\n \u00A0{\n \u00A0_id:\u00A0{\u00A0day:\u00A0{\u00A0$dayOfYear:\u00A0\"$date\"},\u00A0year:\u00A0{\u00A0$year:\u00A0\"$date\"\u00A0}\u00A0},\n \u00A0itemsSold:\u00A0{\u00A0$push:\u00A0{\u00A0item:\u00A0\"$item\",\u00A0quantity:\u00A0\"$quantity\"\u00A0}\u00A0}\n \u00A0}\n \u00A0}\n \u00A0]\n )\n","parent":"7001ec437efe","children":[],"id":"c154ec4f1e24","title":"$push\u00A0\u00A0\u00A0创建新的数组，将值添加进去"},{"parent":"7001ec437efe","children":[],"id":"00713cadffbd","title":"$sum\u00A0\u00A0\u00A0\u00A0求分组数值元素和"},{"parent":"7001ec437efe","children":[],"id":"82237a6d005f","title":"group\u00A0阶段有\u00A0100m内存的使用限制，\u00A0默认情况下，如果超过这个限制会直接返回\u00A0error，可以通过设置\u00A0\u00A0allowDiskUse\u00A0为\u00A0true\u00A0来避免异常，\u00A0allowDiskUse\u00A0为\u00A0true\u00A0将利用临时文件来辅助实现\ngroup操作。"}],"id":"7001ec437efe","title":"$group\u00A0对输入文档进行分组","summaries":[]},{"note":"db.sales.aggregate(\n \u00A0[\n \u00A0{\n \u00A0$group:\n \u00A0{\n \u00A0_id:\u00A0{\u00A0day:\u00A0{\u00A0$dayOfYear:\u00A0\"$date\"},\u00A0year:\u00A0{\u00A0$year:\u00A0\"$date\"\u00A0}\u00A0},\n \u00A0itemsSold:\u00A0{\u00A0$push:\u00A0{\u00A0item:\u00A0\"$item\",\u00A0quantity:\u00A0\"$quantity\"\u00A0}\u00A0}\n \u00A0}\n \u00A0},\n \u00A0{\u00A0$out:\"output\"}\n \u00A0]\n )\n","parent":"75a9650b1942","children":[],"id":"ba1d960c8377","title":"$out\u00A0对管道中的文档输出"},{"parent":"75a9650b1942","children":[{"parent":"26a1b7de6404","children":[],"id":"4308703dc361","title":"\u00A0https://docs.mongodb.com/manual/reference/operator/aggregation-\npipeline/"}],"id":"26a1b7de6404","title":"更多聚合操作参考","summaries":[]}],"id":"75a9650b1942","title":"聚合管道阶段","summaries":[]},{"parent":"71d70a4f984f","children":[{"parent":"09e61a32219e","children":[{"parent":"52b97d606aee","children":[],"id":"3162bd43331a","title":"聚合管道可以确定它是否仅需要文档中的字段的子集来获得结果。如果是这样，管道将只使用那些必需的\n字段，减少通过管道的数据量"}],"id":"52b97d606aee","title":"投影优化","summaries":[]},{"parent":"09e61a32219e","children":[{"parent":"64399f856e1f","children":[],"id":"9f00e3f17960","title":"对于包含投影阶段($project或$unset或$addFields或$set)后跟$match阶段的聚合管道，MongoDB\u00A0将\n$match阶段中不需要在投影阶段计算的值的任何过滤器移动到投影前的新$match阶段"}],"id":"64399f856e1f","title":"管道符号执行顺序优化","summaries":[]},{"parent":"09e61a32219e","children":[{"parent":"661b3f28bacb","children":[],"id":"2cfe3efdbc57","title":"如果序列中带有$sort后跟$match，则$match会移动到$sort之前，以最大程度的减少要排序的对象的数\n量"}],"id":"661b3f28bacb","title":"$sort\u00A0+\u00A0\u00A0$match","summaries":[]},{"parent":"09e61a32219e","children":[{"parent":"eba7e8ae91df","children":[],"id":"bd8687bd6f22","title":"当有一个$project或$unset之后跟有$skip序列时，$skip\u00A0会移至$project之前。"}],"id":"eba7e8ae91df","title":"$project/\u00A0$unset\u00A0+\u00A0$skip序列优化","summaries":[]},{"parent":"09e61a32219e","children":[{"parent":"565f0b7ee827","children":[],"id":"37ed87ababca","title":"当$limit紧接着另一个时\u00A0$limit，两个阶段可以合并为一个阶段\u00A0$limit，其中限制量为两个初始限制量中的\n较小者。"}],"id":"565f0b7ee827","title":"$limit+\u00A0$limit合并","summaries":[]},{"parent":"09e61a32219e","children":[{"parent":"2f1356e84835","children":[],"id":"f80d4dcd5289","title":"当$skip紧跟另一个$skip，这两个阶段可合并成一个单一的$skip，其中跳过量为总和的两个初始跳过量。"}],"id":"2f1356e84835","title":"skip+\u00A0$skip\u00A0合并","summaries":[]},{"parent":"09e61a32219e","children":[{"parent":"c30c36c39a37","children":[],"id":"92cdc1cdc3db","title":"当一个$match紧随另一个紧随其后时\u00A0$match，这两个阶段可以合并为一个单独\u00A0$match的条件\u00A0$and"}],"id":"c30c36c39a37","title":"$match+\u00A0$match合并","summaries":[]}],"id":"09e61a32219e","title":"管道优化","summaries":[]}],"id":"71d70a4f984f","title":"③ 聚合操作","summaries":[]},{"parent":"6b4296c5497b","children":[{"parent":"965c7f26a776","children":[],"id":"faae1367eb31","title":"B+ tree"},{"note":"在创建集合期间，MongoDB\u00A0在_id字段上创建唯一索引。该索引可防止客户端插入两个具有相同值的文\n档。你不能将_id字段上的index删除。\n","parent":"965c7f26a776","children":[],"id":"a6db71beb92c","title":"默认id索引"},{"note":"数据准备：\ndb.members.insertMany( [  {name:\"zhangsan\",age:19,tags:[\"00\",\"IT\",\"SH\"]},  {name:\"lisi\",age:35,tags:[\"80\",\"IT\",\"BJ\"]},  {name:\"wangwu\",age:31,tags:[\"90\",\"IT\",\"SZ\"]}   ]);\n","parent":"965c7f26a776","children":[{"parent":"f84c1389ce0f","children":[{"note":"索引的默认名称是索引键和索引中每个键的方向(即1或-1)的连接，使用下划线作为分隔符，\u00A0也可以通过指\n定\u00A0name\u00A0来自定义索引名称；\n\n对于单字段索引和排序操作，索引键的排序顺序(升序或降序)并不重要，因为MongoDB可以从任何方向遍\n历索引。\n","parent":"9b259d7996fa","children":[],"id":"4a1e77b3962f","title":"db.members.createIndex({name:1})"},{"parent":"9b259d7996fa","children":[],"id":"cd251ffdeffe","title":"db.members.createIndex({name:1}，{\u00A0name:\u00A0&amp;quot;whatever\u00A0u\u00A0like.&amp;quot;});"}],"id":"9b259d7996fa","title":"单键索引","summaries":[]},{"note":"MongoDB支持在多个字段上创建用户定义索引，即\u00A0复合索引。\n复合索引中列出的字段的顺序具有重要意义。如果一个复合索引由\u00A0{name:\u00A01,\u00A0age:\u00A0-1}\u00A0组成，索引首先按\nname\u00A0升序排序，然后在每个name值内按\u00A0age\u00A0降序\u00A0排序。\n","parent":"f84c1389ce0f","children":[{"parent":"bf31669b070f","children":[],"id":"d003a74cd105","title":"db.members.createIndex({name:1,age:-1})"}],"id":"bf31669b070f","title":"复合索引","summaries":[]},{"note":"MongoDB使用多键索引来索引存储在数组中的内容。如果索引包含数组值的字段，MongoDB为数组的每\n个元素创建单独的索引项。数组字段中的每一个元素，都会在多键索引中创建一个键\n","parent":"f84c1389ce0f","children":[{"parent":"c8c3e008158e","children":[],"id":"cd396ee9f933","title":"db.members.createIndex({tags:1})"}],"id":"c8c3e008158e","title":"多键索引","summaries":[]}],"id":"f84c1389ce0f","title":"创建索引","summaries":[]},{"parent":"965c7f26a776","children":[{"parent":"d6a8a8bd3472","children":[],"id":"36f0913e42ab","title":"db.members.getIndexes();"}],"id":"d6a8a8bd3472","title":"查询索引","summaries":[]},{"note":"可以使用\u00A0explain\u00A0进行分析的操作包含\u00A0aggregate,\u00A0count,\u00A0distinct,\u00A0find\u00A0,group,\u00A0remove,\u00A0update\n","parent":"965c7f26a776","children":[{"parent":"2f5ff5b08659","children":[],"id":"044daf4620d9","title":"db.members.explain().find({name:1})"},{"parent":"2f5ff5b08659","children":[{"parent":"8aef078b5b96","children":[],"id":"be65134ca952","title":"COLLSCAN:\u00A0\u00A0整个集合扫描"},{"parent":"8aef078b5b96","children":[],"id":"395e84dc0774","title":"IXScan:\u00A0索引扫描"},{"parent":"8aef078b5b96","children":[],"id":"a0be0d0076b2","title":"FETCH:\u00A0\u00A0根据索引指向的文档的地址进行查询"},{"parent":"8aef078b5b96","children":[],"id":"57db5f7ddcc0","title":"SORT:\u00A0需要再内存中排序，效率不高"}],"id":"8aef078b5b96","title":"winningPlan--&amp;gt;stage","summaries":[]}],"id":"2f5ff5b08659","title":"效果解析","summaries":[]},{"note":"当查询条件和查询的<投影>只包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将\n文档带入内存。这些覆盖的查询可能非常高效。\n","parent":"965c7f26a776","children":[{"parent":"107e52343381","children":[{"parent":"6268900fbb5a","children":[],"id":"34e3bb465369","title":"这时不需要\u00A0fetch,\u00A0可以直接从索引中获取数据。"}],"id":"6268900fbb5a","title":"db.members.explain().find({name:&amp;quot;zhangsan&amp;quot;},{_id:0,name:1})","summaries":[]}],"id":"107e52343381","title":"覆盖查询","summaries":[]},{"parent":"965c7f26a776","children":[{"parent":"b0261a147633","children":[],"id":"ed653af6639f","title":"如果需要更改某些字段上已经创建的索引，必须首先删除原有索引，再重新创建新索引，否则，新索引不\n会包含原有文档"}],"id":"b0261a147633","title":"更改索引","summaries":[]},{"parent":"965c7f26a776","children":[{"parent":"2f563567bc27","children":[{"parent":"ee1d583a14aa","children":[],"id":"e209be901456","title":"db.members.dropIndex(&amp;quot;name_1&amp;quot;)"}],"id":"ee1d583a14aa","title":"使用索引名称删除索引","summaries":[]},{"parent":"2f563567bc27","children":[{"parent":"62eec3123b65","children":[],"id":"a621d079be97","title":"db.members.dropIndex({tags:1})"}],"id":"62eec3123b65","title":"使用索引定义删除索引","summaries":[]}],"id":"2f563567bc27","title":"删除索引","summaries":[]},{"note":"索引的unique属性使MongoDB拒绝索引字段的重复值。除了唯一性约束，唯一索引和MongoDB其他索\n引功能上是一致的\n如果文档中的字段已经出现了重复值，则不可以创建该字段的唯一性索引\n如果新增的文档不具备加了唯一索引的字段，则只有第一个缺失该字段的文档可以被添加，索引中该键值\n被置为null。\n复合键索引也可以具有唯一性，这种情况下，不同的文档之间，其所包含的复合键字段值的组合不可以重\n复。\n","parent":"965c7f26a776","children":[{"parent":"c1db2094726d","children":[{"parent":"c581a29bbf25","children":[],"id":"09128e9f6585","title":"如果哪些文档没有name，那么这些文档就不会被索引"}],"id":"c581a29bbf25","title":"db.members.createIndex({name:1},{unique:true})","summaries":[]}],"id":"c1db2094726d","title":"索引的唯一性","summaries":[]},{"parent":"965c7f26a776","children":[{"parent":"e8de098fe1a7","children":[],"id":"65872dee1d09","title":"db.sparsedemo.createIndex({name:1},{sparse:true});"}],"id":"e8de098fe1a7","title":"索引的稀疏性","summaries":[]},{"note":"在create_time字段上面创建了一个生存时间是30s的索引\n\n复合键索引不具备生存时间的特性\n","parent":"965c7f26a776","children":[{"parent":"48e89ecd69b6","children":[{"parent":"f88d0d042c17","children":[],"id":"b90214f9ddc3","title":"在create_time上创建了一个30s过期的索引"}],"id":"f88d0d042c17","title":"db.members.createIndex({\u00A0create_time:\u00A01},{expireAfterSeconds:30\u00A0});","summaries":[]}],"id":"48e89ecd69b6","title":"索引的过期时间","summaries":[]},{"parent":"965c7f26a776","children":[{"parent":"fb5b18f22c25","children":[],"id":"ecd01409efe0","title":"https://docs.mongodb.com/manual/core/index-compound/#index-ascending-and-descending"},{"parent":"fb5b18f22c25","children":[],"id":"2a6536b5072f","title":"https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/#pipe._S_addFields"}],"id":"fb5b18f22c25","title":"参考文档","summaries":[]}],"id":"965c7f26a776","title":"④ 索引","summaries":[]},{"parent":"6b4296c5497b","children":[{"parent":"c25ddda6235c","children":[{"parent":"ae581d536ad5","children":[],"id":"4d0322b0ad54","title":"数据分发：将数据从一个区域复制到另一个区域，减少另一个区域的读延迟"},{"parent":"ae581d536ad5","children":[],"id":"d56ea870a483","title":"读写分离：不同类型的压力分别在不同的节点上执行"},{"parent":"ae581d536ad5","children":[],"id":"868082a8c450","title":"异地容灾：在数据中心故障时快速切换到异地"}],"id":"ae581d536ad5","title":"主要意义-实现服务高可用，类似于redis的哨兵模式","summaries":[]},{"parent":"c25ddda6235c","children":[{"parent":"927fb2a1415a","children":[],"id":"074d7ef42e18","title":"数据写入主节点时将数据复制到另一个副本节点上"},{"parent":"927fb2a1415a","children":[],"id":"da88c8404fad","title":"主节点发生故障时自动选举出一个新的替代节点"}],"id":"927fb2a1415a","title":"功能","summaries":[]},{"note":"当一个修改操作，无论是插入，更新或删除，到达主节点时，它对数据的操作将被记录下来（经\n过一些必要的转换）。这些记录称为oplog\n从节点通过从主节点上不断获取新进入主节点的oplog，并在自己的数据上回放，以此保持跟主\n节点的数据一致。\n","parent":"c25ddda6235c","children":[],"id":"ab12593d1e73","title":"主从数据如何复制"},{"note":"具有投票权的节点之间两两互相发送心跳；\n当5次心跳未收到时判断为节点失联\n如果失联的是主机点，从节点会发起选举，选出新的主节点\n如果失联的是从节点则不会产生新的选举\n选举基于RAFT一致性算法实现，选举成功的必要条件是大多数投票节点存活\n复制集中最多可以有50个节点，但具有投票权的节点最多7个\n","parent":"c25ddda6235c","children":[{"parent":"bdcb236d40e4","children":[{"parent":"347944e85fd4","children":[],"id":"e2903d123462","title":"整个集群必须有大多数节点存活"},{"parent":"347944e85fd4","children":[{"parent":"04d519ab9d7e","children":[],"id":"7658b28861ce","title":"1.能够与多数节点建立连接"},{"parent":"04d519ab9d7e","children":[],"id":"e96561970c0e","title":"2.具有较新的oplog"},{"parent":"04d519ab9d7e","children":[],"id":"f24361214ce0","title":"3.具有较高的优先级（如果有配置）"}],"id":"04d519ab9d7e","title":"被选举为主节点的节点必须","summaries":[]}],"id":"347944e85fd4","title":"影响选举因素","summaries":[]}],"id":"bdcb236d40e4","title":"通过选举完成故障恢复","summaries":[]},{"parent":"c25ddda6235c","children":[{"parent":"41b7738e0647","children":[],"id":"bb048fcfc11b","title":"是否具有投票权（v参数）有则参与投票"},{"parent":"41b7738e0647","children":[],"id":"27392f0cf904","title":"优先级（priority参数）：优先级越高的节点越优先成为主节点。优先级为0的节点无法成为主节\n点,默认值为1。"},{"parent":"41b7738e0647","children":[],"id":"fcf4e31f63e1","title":"隐藏（hidden参数）：复制数据，但对应用不可见。隐藏节点可以具有投票权，但优先级必须为\n0"},{"parent":"41b7738e0647","children":[],"id":"d477502a3ea7","title":"延迟（slaveDelay参数）：复制\u00A0n\u00A0秒之前的数据，保持与主节点的时间差"},{"parent":"41b7738e0647","children":[],"id":"f09383f266dc","title":"从节点不建立索引(\u00A0buildIndexes)"}],"id":"41b7738e0647","title":"复制集节点的选配项","summaries":[]},{"parent":"c25ddda6235c","children":[{"parent":"8aeba51a34b9","children":[],"id":"536ef505da6f","title":"https://note.youdao.com/noteshare?id=f42ca06d983dd456e9d158bcbb025477"}],"id":"8aeba51a34b9","title":"搭建复制集和分片集群，整合springBoot","summaries":[]}],"id":"c25ddda6235c","title":"⑤ 复制集","summaries":[]}],"id":"6b4296c5497b","title":"mongodb","summaries":[]}],"root":true,"theme":"delicate_caihong","id":"root","title":"数据库","structure":"mind_free","summaries":[]}},"meta":{"exportTime":"2022-03-23 14:12:33","member":"5e3bb9a1e4b05c26be9f8c33","diagramInfo":{"creator":"5e3bb9a1e4b05c26be9f8c33","created":"2022-03-22 17:17:54","modified":"2022-03-23 14:12:16","title":"mongodb笔记","category":"mind_right"},"id":"623994420e3e74074cf83802","type":"ProcessOn Schema File","version":"1.0"}}